!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("itowns_lasparser",[],e):"object"==typeof exports?exports.itowns_lasparser=e():t.itowns_lasparser=e()}(self,(()=>(()=>{var t,e,r={10539:()=>{},57699:(t,e,r)=>{"use strict";var n=r(15702),o=r(26977),a=r(15234);function i(t){return 1===t.majorVersion&&t.minorVersion<=2?8:16}const s=new class{constructor(){this._wasmPath="https://cdn.jsdelivr.net/npm/laz-perf@0.0.6/lib",this._wasmPromise=null}_initDecoder(){return this._wasmPromise||(this._wasmPromise=o.LazPerf.create({locateFile:t=>`${this._wasmPath}/${t}`})),this._wasmPromise}_parseView(t,e){const r=e.colorDepth??16,n=["X","Y","Z"].map(t.getter),o=t.getter("Intensity"),a=t.getter("ReturnNumber"),i=t.getter("NumberOfReturns"),s=t.getter("Classification"),p=t.getter("PointSourceId"),c=t.dimensions.Red?["Red","Green","Blue"].map(t.getter):void 0,u=t.getter("ScanAngle"),l=new Float32Array(3*t.pointCount),f=new Uint16Array(t.pointCount),h=new Uint8Array(t.pointCount),m=new Uint8Array(t.pointCount),w=new Uint8Array(t.pointCount),d=new Uint16Array(t.pointCount),y=c?new Uint8Array(4*t.pointCount):void 0,g=new Float32Array(t.pointCount),b=n.map((t=>t(0))).map((t=>Math.floor(t)));for(let e=0;e<t.pointCount;e++){const[t,v,C]=n.map((t=>t(e)));if(l[3*e]=t-b[0],l[3*e+1]=v-b[1],l[3*e+2]=C-b[2],f[e]=o(e),h[e]=a(e),m[e]=i(e),c){let[t,n,o]=c.map((t=>t(e)));16===r&&(t/=256,n/=256,o/=256),y[4*e]=t,y[4*e+1]=n,y[4*e+2]=o,y[4*e+3]=255}w[e]=s(e),d[e]=p(e),g[e]=u(e)}return{position:l,intensity:f,returnNumber:h,numberOfReturns:m,classification:w,pointSourceID:d,color:y,scanAngle:g,origin:b}}set lazPerf(t){this._wasmPath=t,this._wasmPromise=null}async parseChunk(t,e){const{header:r,eb:n,pointCount:o}=e,{pointDataRecordFormat:s,pointDataRecordLength:p}=r,c=e.colorDepth??i(r),u=new Uint8Array(t),l=await a.Las.PointData.decompressChunk(u,{pointCount:o,pointDataRecordFormat:s,pointDataRecordLength:p},this._initDecoder()),f=a.Las.View.create(l,r,n);return{attributes:this._parseView(f,{colorDepth:c})}}async parseFile(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new Uint8Array(t),n=await a.Las.PointData.decompressFile(r,this._initDecoder()),o=a.Las.Header.parse(r),s=e.colorDepth??i(o),p=async(t,e)=>r.slice(t,e),c=await a.Las.Vlr.walk(p,o),u=a.Las.Vlr.find(c,"LASF_Spec",4),l=u&&a.Las.ExtraBytes.parse(await a.Las.Vlr.fetch(p,u)),f=a.Las.View.create(n,o,l);return{header:o,attributes:this._parseView(f,{colorDepth:s})}}};function p(t){return Object.values(t).filter(ArrayBuffer.isView).map((t=>t.buffer))}(0,n.p)({lazPerf(t){s.lazPerf=t},async parseChunk(t,e){const r=await s.parseChunk(t,e);return(0,n.mr)(r,p(r.attributes))},async parseFile(t,e){const r=await s.parseFile(t,e);return(0,n.mr)(r,p(r.attributes))}})}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var a=n[t]={exports:{}};return r[t].call(a.exports,a,a.exports,o),a.exports}return o.m=r,o.x=()=>{var t=o.O(void 0,[455],(()=>o(57699)));return o.O(t)},t=[],o.O=(e,r,n,a)=>{if(!r){var i=1/0;for(u=0;u<t.length;u++){for(var[r,n,a]=t[u],s=!0,p=0;p<r.length;p++)(!1&a||i>=a)&&Object.keys(o.O).every((t=>o.O[t](r[p])))?r.splice(p--,1):(s=!1,a<i&&(i=a));if(s){t.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}a=a||0;for(var u=t.length;u>0&&t[u-1][2]>a;u--)t[u]=t[u-1];t[u]=[r,n,a]},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,r)=>(o.f[r](t,e),e)),[])),o.u=t=>t+".js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={899:1};o.f.i=(e,r)=>{t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunkitowns=self.webpackChunkitowns||[],r=e.push.bind(e);e.push=e=>{var[n,a,i]=e;for(var s in a)o.o(a,s)&&(o.m[s]=a[s]);for(i&&i(o);n.length;)t[n.pop()]=1;r(e)}})(),e=o.x,o.x=()=>o.e(455).then(e),o.x()})()));
//# sourceMappingURL=itowns_lasparser.js.map